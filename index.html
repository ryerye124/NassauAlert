<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nassau County Fire Ops Dashboard</title>
<style>
  body {
    margin: 0;
    background: #111;
    font-family: Arial, sans-serif;
    margin-top: 50px;
    color: #0f0;
  }

  /* Title Bar */
  #title-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: #222;
    color: #0f0;
    font-family: 'Courier New', monospace;
    font-size: 18px;
    font-weight: bold;
    padding: 10px 60px;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  #alert-ticker {
    margin: 0 20px;
    color: #ff0;
    font-family: 'Courier New', monospace;
    white-space: nowrap;
    overflow: hidden;
    max-width: 40%;
  }

  .ticker span {
    display: inline-block;
    padding-left: 100%;
    animation: ticker-scroll 190s linear infinite;
  }

  @keyframes ticker-scroll {
    from { transform: translateX(0); }
    to { transform: translateX(-100%); }
  }

  /* Dashboard Grid */
  #dashboard {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, 50vh);
    gap: 5px;
    transition: all 0.3s ease;
  }

  .panel {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    transition: all 0.3s ease;
    background: #000;
  }

  .panel iframe,
  .panel img {
    width: 100%;
    height: 100%;
    border: none;
    transition: all 0.3s ease;
    object-fit: contain;
  }

  .sub-grid {
    display: grid;
    grid-template-rows: 1fr 1fr;
    gap: 5px;
    height: 100%;
  }

  /* Labels */
  .label {
    position: absolute;
    top: 5px;
    left: 5px;
    background: rgba(0,0,0,0.85);
    color: #0f0;
    padding: 5px 10px;
    font-size: 15px;
    font-weight: bold;
    border-radius: 5px;
    z-index: 10;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .label:hover {
    color: #fff;
    background: rgba(0,255,0,0.9);
    transform: scale(1.05);
  }

  .panel:hover {
    box-shadow: 0 0 15px #0f0;
    transition: box-shadow 0.3s ease;
  }

  .fullscreen {
    position: fixed !important;
    top: 50px;
    left: 0;
    width: 100% !important;
    height: calc(100% - 50px) !important;
    z-index: 999;
    grid-column: 1 / -1 !important;
    grid-row: 1 / -1 !important;
    background: #000;
  }
</style>
</head>
<body>

<!-- Title Bar -->
<div id="title-bar">
  <span id="zulu-time"></span>
  <span id="alert-ticker" class="ticker">Loading alerts...</span>
  <span id="est-time"></span>
</div>

<!-- Dashboard Grid -->
<div id="dashboard"></div>

<script>
// ---------------- CONFIG ----------------
const panels = [
  { label: "Live Scanner", type: "iframe", src: "https://www.broadcastify.com/webPlayer/1635" },
  { label: "Fire Weather Map", type: "iframe", src: "https://cdn.star.nesdis.noaa.gov/GOES19/ABI/SECTOR/ne/FireTemperature/20252351741_GOES19-ABI-ne-FireTemperature-600x600.jpg" },
  { label: "SPC Fire Outlook", type: "img", src: "https://www.nifc.gov/nicc-files/predictive/outlooks/month1_outlook.png" },
  { label: "Air Quality / Smoke", type: "iframe", src: "https://fire.airnow.gov/" },
  { label: "Active Incidents", type: "iframe", src: "https://incidents.fire.ca.gov/active" }, // placeholder
  { 
    label: "Sub Grid", 
    type: "subgrid",
    children: [
      { label: "Forecast (NWS)", type: "img", src: "https://graphical.weather.gov/sectors/northeast.php?FireWx" },
      { label: "Social Feed", type: "iframe", src: "https://twitter.com/FDNYFireWire" }
    ]
  }
];
// -----------------------------------------

// Render Panels
const dashboard = document.getElementById("dashboard");
panels.forEach(p => {
  const panel = document.createElement("div");
  panel.className = "panel";

  if (p.type === "subgrid") {
    const sub = document.createElement("div");
    sub.className = "sub-grid";
    p.children.forEach(c => {
      const childPanel = document.createElement("div");
      childPanel.className = "panel";
      const label = document.createElement("span");
      label.className = "label";
      label.textContent = c.label;
      childPanel.appendChild(label);
      if (c.type === "iframe") {
        const iframe = document.createElement("iframe");
        iframe.src = c.src;
        childPanel.appendChild(iframe);
      } else if (c.type === "img") {
        const img = document.createElement("img");
        img.src = c.src;
        childPanel.appendChild(img);
      }
      sub.appendChild(childPanel);
    });
    const label = document.createElement("span");
    label.className = "label";
    label.textContent = p.label;
    panel.appendChild(label);
    panel.appendChild(sub);
  } else {
    const label = document.createElement("span");
    label.className = "label";
    label.textContent = p.label;
    panel.appendChild(label);
    if (p.type === "iframe") {
      const iframe = document.createElement("iframe");
      iframe.src = p.src;
      panel.appendChild(iframe);
    } else if (p.type === "img") {
      const img = document.createElement("img");
      img.src = p.src;
      panel.appendChild(img);
    }
  }
  dashboard.appendChild(panel);
});

// ---------------- TIME ----------------
function updateTime() {
  const now = new Date();
  const zulu = now.toISOString().replace('T', ' ').split('.')[0] + " Z";
  const estOptions = { timeZone: 'America/New_York', hour12: false };
  const est = now.toLocaleString('en-US', estOptions);
  document.getElementById('zulu-time').textContent = `Zulu Time: ${zulu}`;
  document.getElementById('est-time').textContent = `EST: ${est}`;
}
setInterval(updateTime, 1000);
updateTime();

// ---------------- ALERT TICKER ----------------
async function fetchAlerts() {
  try {
    const response = await fetch('https://api.weather.gov/alerts/active?area=NY');
    if (!response.ok) return [];
    const data = await response.json();
    return data.features
      .filter(f => /Fire|Red Flag|Smoke/i.test(f.properties.event))
      .map(f => f.properties.headline);
  } catch (e) {
    return [];
  }
}
async function updateAlerts() {
  const alerts = await fetchAlerts();
  const ticker = document.getElementById('alert-ticker');
  ticker.innerHTML = alerts.length === 0
    ? 'No current fire-related alerts'
    : `<span>${alerts.join('  â€¢  ')}</span>`;
}
setInterval(updateAlerts, 60 * 1000);
updateAlerts();

// ---------------- FULLSCREEN ----------------
function enableFullscreen() {
  const panels = document.querySelectorAll('.panel');
  panels.forEach(panel => {
    const label = panel.querySelector('.label');
    label.addEventListener('click', e => {
      e.stopPropagation();
      panels.forEach(p => p.classList.remove('fullscreen'));
      panel.classList.add('fullscreen');
    });
    panel.addEventListener('click', () => {
      if(panel.classList.contains('fullscreen')){
        panel.classList.remove('fullscreen');
      }
    });
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      panels.forEach(p => p.classList.remove('fullscreen'));
    }
  });
}
enableFullscreen();
</script>
</body>
</html>
